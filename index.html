<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Premanand Maharaj AI Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center px-4">
  <div class="bg-white shadow-xl rounded-2xl p-6 max-w-xl w-full space-y-4">
    <div class="flex justify-center">
      <img src="./prem_ai.jpeg" alt="Premanand Maharaj" class="w-32 h-32 rounded-full shadow-md ring-4 ring-yellow-300 object-cover"/>
    </div>

    <div class="flex items-center justify-between">
      <h1 class="text-2xl font-bold text-indigo-700">ЁЯХЙя╕П рдкреНрд░реЗрдорд╛рдирдВрдж рдорд╣рд╛рд░рд╛рдЬ AI</h1>
      <button onclick="speakWelcome()" class="bg-yellow-400 hover:bg-yellow-500 text-white font-semibold px-4 py-1 rounded-lg text-sm transition">
        ЁЯОд рд╕реБрдиреЗрдВ (Listen)
      </button>
    </div>
    
    
    <h2 class="text-md text-gray-600 text-center">Premanand Maharaj AI Discussion</h2>

    <textarea
      id="question"
      rows="4"
      placeholder="рдЕрдкрдирд╛ рдкреНрд░рд╢реНрди рдпрд╣рд╛рдБ рдЯрд╛рдЗрдк рдХрд░реЗрдВ... (Type your question here...)"
      class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-400 resize-none"
    ></textarea>

    <button
      onclick="askAI()"
      class="w-full bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-700 transition"
    >
      рдкреВрдЫреЗрдВ (Ask)
    </button>

    <div id="answer" class="bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 min-h-[60px] text-gray-800">
      <!-- Hindi Answer -->
    </div>
    
    <div id="english-answer" class="bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 min-h-[60px] text-gray-600 italic">
      <!-- English Translation -->
    </div>
  </div>

  <script>
    async function askAI() {
      const question = document.getElementById('question').value;
      const answerElement = document.getElementById('answer');
      const englishAnswerElement = document.getElementById('english-answer');

      if (!question.trim()) {
        answerElement.innerText = "рдХреГрдкрдпрд╛ рдПрдХ рдкреНрд░рд╢реНрди рджрд░реНрдЬ рдХрд░реЗрдВ!";
        englishAnswerElement.innerText = "Please enter a question!";
        return;
      }

      answerElement.innerText = "рдЙрддреНрддрд░ рдЖ рд░рд╣рд╛ рд╣реИ...";
      englishAnswerElement.innerText = "Fetching response...";

      try {
        const response = await fetch('https://mynodeserver-ivk5.onrender.com/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });

        const data = await response.json();
        console.log("Server Response:", data);

        if (data.answer) {
          answerElement.innerText = `ЁЯХЙя╕П рд╣рд┐рдВрджреА рдЙрддреНрддрд░: ${data.answer}`;
          speakHindi(data.answer);

          const englishTranslation = await translateToEnglish(data.answer);
          englishAnswerElement.innerText = `ЁЯФ╣ English Translation: ${englishTranslation}`;
        } else {
          answerElement.innerText = "рдХреЛрдИ рдЙрддреНрддрд░ рдирд╣реАрдВ рдорд┐рд▓рд╛ред рдХреГрдкрдпрд╛ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред";
          englishAnswerElement.innerText = "No answer received. Please try again.";
        }
      } catch (error) {
        console.error("Error:", error);
        answerElement.innerText = "тЭМ рдХреБрдЫ рдЧрд▓рдд рд╣реБрдЖред рдХреГрдкрдпрд╛ рд╕рд░реНрд╡рд░ рдЬрд╛рдВрдЪреЗрдВред";
        englishAnswerElement.innerText = "тЭМ Something went wrong. Please check the server.";
      }
    }

    async function translateToEnglish(hindiText) {
      try {
        const response = await fetch('https://api.mymemory.translated.net/get?q=' + encodeURIComponent(hindiText) + '&langpair=hi|en');
        const data = await response.json();
        return data.responseData.translatedText || "Translation unavailable.";
      } catch {
        return "Translation service failed.";
      }
    }

    function speakWelcome() {
      const welcomeText = " рд╕реНрд╡рд╛рдЧрдд рд╣реИ! рдкреНрд░реЗрдорд╛рдирдВрдж рдорд╣рд╛рд░рд╛рдЬ рдПрдЖрдИ рдореЗрдВ рдЖрдкрдХрд╛ рд╣рд╛рд░реНрджрд┐рдХ рд╕реНрд╡рд╛рдЧрдд рд╣реИред";
      speakHindi(welcomeText);
    }

    function speakHindi(text) {
      if (!window.speechSynthesis) {
        alert("Voice not supported in this browser.");
        return;
      }

      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'hi-IN';
      utterance.rate = 0.95;

      console.log("Speaking:", text);

      speechSynthesis.cancel(); // Stop any current speech
      speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>
